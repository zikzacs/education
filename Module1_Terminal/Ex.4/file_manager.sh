#!/bin/bash

# Проверка, был ли передан аргумент (путь к директории)
if [ -z "$1" ]; then
    echo "Ошибка: Не указана директория"
    echo "Использование: $0 <путь_к_директории>"
    exit 1  # Завершаем скрипт с кодом ошибки 1
fi

# Проверка существования указанной директории
if [ ! -d "$1" ]; then
    echo "Ошибка: Директория '$1' не существует"
    exit 1  # Завершаем скрипт с кодом ошибки 1
fi

# Инициализация счетчиков для статистики
txt_count=0      # Счетчик текстовых файлов (.txt)
exe_count=0      # Счетчик исполняемых файлов (+x)
empty_dir_count=0 # Счетчик пустых директорий

# Цикл по всем элементам в указанной директории
for item in "$1"/*; do
    
    # Проверка, является ли элемент файлом
    if [ -f "$item" ]; then
        
        # Проверка расширения файла (текстовые .txt)
        case "$item" in
            *.txt)
                echo "=== Текстовый файл: $item ==="
                head -n 3 "$item"  # Вывод первых 3 строк файла
                ((txt_count++))    # Увеличение счетчика txt-файлов
                ;;
            *)
                # Проверка, является ли файл исполняемым (права +x)
                if [ -x "$item" ]; then
                    echo "=== Исполняемый файл: $item ==="
                    # Вывод размера файла (du -sh) и обрезка лишнего (cut -f1)
                    echo "Размер: $(du -sh "$item" | cut -f1)"
                    ((exe_count++))  # Увеличение счетчика exe-файлов
                fi
                ;;
        esac
    
    # Проверка, является ли элемент директорией
    elif [ -d "$item" ]; then
        # Проверка, пуста ли директория (ls -A выводит содержимое без . и ..)
        if [ -z "$(ls -A "$item")" ]; then
            echo "=== Предупреждение: Пустая директория ==="
            echo "$item"
            ((empty_dir_count++))  # Увеличение счетчика пустых директорий
        fi
    fi
done

# Вывод финальной статистики
echo "=== Статистика ==="
echo "Найдено: $txt_count txt, $exe_count exe, $empty_dir_count пустых папки"
